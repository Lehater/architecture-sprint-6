[назад](../README.md)

# Задание 6. Настройка Rate Limiting

> Сделайте так, чтобы при превышении лимита запросов клиент получал HTTP-ошибку с кодом 429
 
Доработанный конфигурационный файл Nginx, 
который ограничивает количество запросов до 10 в минуту для каждого уникального IP-адреса, 
а при превышении лимита возвращает HTTP-статус 429 (Too Many Requests).

```nginx
http {
    # 1. Определяем shared-зону для лимитирования (myzone) и указываем скорость 10 запросов в минуту
    limit_req_zone $binary_remote_addr zone=myzone:10m rate=10r/m;

    # Настройка upstream для балансировки нагрузки
    upstream backend_servers {
        server backend1.example.com;
        server backend2.example.com;
        server backend3.example.com;
    }

    server {
        listen 80;

        location / {
            # 2. Применяем настройку Rate Limiting
            limit_req zone=myzone burst=5 nodelay;
            limit_req_status 429;

            proxy_pass http://backend_servers;
        }
    }
}
```

1. **limit_req_zone** — объявляет зону для хранения счётчиков запросов (myzone) и задаёт скорость (rate=10r/m означает 10 запросов в минуту).  
   - `zone=myzone:10m` говорит Nginx хранить счётчики в памяти объёмом 10 МБ (можно корректировать по необходимости).

2. **limit_req** в `location /`:
   - **zone=myzone** — указывает, что используем ранее объявленную зону лимитирования.
   - **burst=5** — допускает «всплеск» в 5 запросов сверх лимита, прежде чем начать возвращать ошибку.
   - **nodelay** — означает, что «лишние» запросы будут получать отказ сразу (429), без искусственной задержки.
   - **limit_req_status 429** — задаёт конкретный код ответа при превышении лимита (по умолчанию 503).

Таким образом, если клиент превысит 10 запросов в минуту (с учётом burst), Nginx вернёт ошибку `429 Too Many Requests`.

[назад](../README.md)